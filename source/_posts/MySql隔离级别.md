---
title: Mysql优化相关
categories: Mysql
tags: Mysql
---
 #### Innodb是如何支持范围查找能走索引的
 select name from user where id >6; 先利用索引查询id=6的情况 在得出>6 B+树
 
 #### 遵守最左前缀原则才能利用联合索引查询
 
 #### 走索引不一定比全表扫描快，看需要回表的次数
 
 #### 索引扫描的底层原理
 select id from user id为索引时也是默认走的索引查询。全表扫描查的是全部字段的所有数据值，索引查的是id字段的所有数据值。
 
 #### order by会导致索引失效
 mysql认为走全表扫描比索引速度更快，全表扫描不需要回表，在内存中经行排序，走索引需要回表但是不需要额外排序。综合起来还是全表扫描比较快。
 
 #### mysql读写分离（复制原理）
 mysql一次插入的时候会生成binlog日志->从库的io线程会获得binlog日志->生成relaylog->解析成从库数据插入
 
 #### 分库分表
 对某个字段进行hash然后取模放到对应的表中
 对时间进行分表（一月、二月等等）
 
  #### 聚簇索引和非聚簇索引的区别
  聚簇索引：将数据存储与索引放到了一块，并且是按照一定的顺序组织的，找到索引也就找到了数据，数据的物理存放顺序是一直的，即索引是相邻的那么对应的数据一定也是相邻的存放在磁盘上的。
  非聚簇索引：叶子节点不存储数据，存储的是数据行地址，也就是说根据索引查找到数据行的位置再去磁盘查找数据。
  优势：通过聚簇索引可以直接获取数据不需要二次查询要率告
		聚簇索引对于范围查询的效率很高，因为其数据是按照大小排序的
		聚簇索引适用在排序的场合，非聚簇索引不适合
  劣势：索引的维护很昂贵
		表因为使用uuid作为主键，使数据存储稀疏，可能会出现聚簇索引比全表扫描更慢，建议使用自增序列作为主键
		如果主键比较大的话，那辅助索引将会变得更大，引文辅助索引的叶子存储的使主键值，过长的主键值会导致非叶子节点占用更多的物理空间
		
  #### 索引选择
  除开单条记录查询选择hash索引，其余部分建议选择BTree索引
  
  #### 索引设计的原则
  查询更快，占用空间更小
  1.适合索引的列是出现在where子句中的列，或者连接子句中指定的列
  2.基数较小的表，索引效果差，没必要建立索引
  3.使用短索引，如果对长字符串列进行索引，应该指定一个前缀长度，这样能够节省大量索引空间，如果搜索词超过所有前缀长度，则使用索引排除不匹配的行，然后检查其余行是否可能匹配
  4.不要过度索引，索引需要额外的磁盘空间。
  5.定义有外键的数据列一定要建立索引。
  6.更新频繁的字段不适合建立索引
  7.对于查询中很少涉及的列，重复值比较多的列不要建立索引
  8.定义为text、image和bit的数据类型不要建立索引
  
  #### 怎么处理慢查询
  